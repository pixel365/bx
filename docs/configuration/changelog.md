# Changelog

Есть три способа включить описание релиза в дистрибутив:

- Включить в один из этапов сборки файл `description.ru`
- Использовать флаг `--description` для команды `build`
- Автоматически сгенерировать описание на основе коммитов.

В этом разделе описывается третий способ описания релиза, а именно секция `changelog`.

- `from` * &mdash; Начало истории изменений.
  - `type` * &mdash; Возможные значения: `tag`, `commit`
  - `value` * &mdash; Конкретный тэг или хэш коммита. В зависимости от того что указано в `type`.
- `to` * &mdash; Окончание истории изменений.
  - `type` * &mdash; Возможные значения: `tag`, `commit`
  - `value` * &mdash; Конкретный тэг или хэш коммита. В зависимости от того что указано в `type`.
- `condition` &mdash; Условие для включения или исключения коммитов при генерации истории изменений.
  - `type` ** &mdash; Возможные значения: `include`, `exclude`.
  - `value` ** &mdash; Список валидных регулярных выражений для фильтрации коммитов.
- `sort` &mdash; Сортировка коммитов. Возможные значения: `asc`, `desc`. По-умолчанию `asc`.
- `footerTemplate` &mdash; Текст, который будет добавлен в конец истории изменений. Например, предупреждение о необходимости предварительного создания резервной копии.
- `transform` — Описание правил преобразования текста коммитов перед записью в changelog. Полезно, например, для удаления технических префиксов (`feat:`, `fix:`) и повышения читаемости итогового текста.
  - `type` ** — Тип трансформации. На текущий момент поддерживается:
    - `stripPrefix` — удаляет указанные префиксы из начала сообщения.
    - `stripSuffix` — удаляет указанные суффиксы из конца сообщения.
    - `removeAll` — удаляет все вхождения указанной подстроки из сообщения и нормализует пробелы.
  - `value` ** — Список строк, которые нужно удалить (например: `feat:`, `fix:`).

"*" &mdash; Обязательное поле.

"**" &mdash; Обязательное поле если присутствует родитель.

*Обратите внимание, что генерация описания на базе истории коммитов, возможна только в том случае, если [repository](configuration/main.md) не пустой.*

*Стоит учесть, что преобразования из `transform` выполняются в том порядке, в котором указаны.*

### Пример

```yaml
changelog:
  from:
    type: "tag"
    value: "v1.0.0"
  to:
    type: "tag"
    value: "v2.0.0"
  condition:
    type: "include"
    value:
      - '^feat:([\\W\\w]+)$'
      - '^fix:([\\W\\w]+)$'
  transform:
    - type: "stripPrefix"
      value:
        - "feat:"
        - "fix:"
    - type: "stripSuffix"
      value:
        - "YYY"
    - type: "removeAll"
      value:
        - "substring"
  sort: "desc"
  footerTemplate: >
    Внимание: перед обновлением обязательно 
    сделайте полную резервную копию!
```

В данном примере будет сгенерирован файл description.ru, на основе истории изменений начиная с тэга v1.0.0 и заканчивая тэгом v2.0.0.

В список изменений попадут только те коммиты, текст которых начинается с `feat:` или `fix:`.

Они будут отсортированы в порядке убывания по тексту сообщения.

В конец описания будет добавлен текст: `Внимание: перед обновлением обязательно сделайте полную резервную копию!`

Итоговый description.ru будет выглядеть примерно так:

- Без transform

```text
fix: исправлена ошибка в компоненте XXX
fix: исправлена ошибка в компоненте YYY
feat: добавлена фича XXX
feat: добавлена фича YYY

Внимание: перед обновлением обязательно сделайте полную резервную копию!
```

- С transform

```text
исправлена ошибка в компоненте XXX
исправлена ошибка в компоненте
добавлена фича XXX
добавлена фича

Внимание: перед обновлением обязательно сделайте полную резервную копию!
```

Как итог, это описание релиза будет опубликовано в карточке модуля в 1С-Битрикс Маркетплейс.
